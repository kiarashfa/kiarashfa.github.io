<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Kiarash Farajzadehahary - Photo Gallery">
    <meta name="author" content="Kiarash Farajzadehahary">
    <title>Gallery | Kiarash Farajzadehahary</title>

    <!-- Favicons -->
    <link rel="icon" type="image/x-icon" href="../assets/favicons/favicon.ico">
    <link rel="icon" type="image/png" sizes="16x16" href="../assets/favicons/favicon-16x16.png">
    <link rel="icon" type="image/png" sizes="32x32" href="../assets/favicons/favicon-32x32.png">
    <link rel="apple-touch-icon" sizes="180x180" href="../assets/favicons/apple-touch-icon.png">
    <link rel="manifest" href="../assets/favicons/site.webmanifest">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="../css/style.css">
    
    <style>
        /* Gallery Specific Styles */
        .gallery-container {
            position: relative;
            z-index: 2;
            padding: 2rem;
            min-height: 100vh;
            padding-top: 120px;
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .gallery-header {
            text-align: center;
            margin-bottom: 3rem;
        }
        
        .gallery-title {
            font-size: 3rem;
            font-weight: 100;
            letter-spacing: 0.2em;
            margin-bottom: 1rem;
            text-transform: uppercase;
            background: linear-gradient(135deg, #49c5b6, #FF9398);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .gallery-subtitle {
            font-size: 1.1rem;
            font-weight: 300;
            opacity: 0.7;
            letter-spacing: 0.1em;
        }
        
        /* Filter Tabs */
        .filter-container {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 1.5rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
            margin-bottom: 3rem;
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            justify-content: center;
            pointer-events: auto;
        }
        
        .filter-btn {
            padding: 0.8rem 1.8rem;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 25px;
            color: rgba(255, 255, 255, 0.7);
            cursor: none;
            transition: all 0.3s ease;
            font-size: 0.9rem;
            letter-spacing: 0.05em;
            text-transform: uppercase;
        }
        
        .filter-btn:hover {
            background: rgba(73, 197, 182, 0.15);
            border-color: rgba(73, 197, 182, 0.5);
            color: #49c5b6;
            transform: translateY(-2px);
        }
        
        .filter-btn.active {
            background: rgba(73, 197, 182, 0.25);
            border-color: #49c5b6;
            color: #49c5b6;
        }
        
        /* Gallery Grid */
        .gallery-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1.5rem;
            margin-bottom: 4rem;
        }
        
        .gallery-item {
            position: relative;
            aspect-ratio: 1 / 1;
            overflow: hidden;
            border-radius: 15px;
            cursor: none;
            pointer-events: auto;
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.4s ease;
        }
        
        .gallery-item:hover {
            transform: translateY(-5px);
            border-color: rgba(73, 197, 182, 0.5);
            box-shadow: 0 10px 40px rgba(73, 197, 182, 0.3);
        }
        
        .gallery-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.4s ease;
        }
        
        .gallery-item:hover img {
            transform: scale(1.1);
        }
        
        .gallery-item.hidden {
            display: none;
        }
        
        /* Loading spinner for lazy load */
        .gallery-item.loading {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .gallery-item.loading::before {
            content: "\f110";
            font-family: "Font Awesome 6 Free";
            font-weight: 900;
            font-size: 2rem;
            color: rgba(73, 197, 182, 0.5);
            animation: fa-spin 1s infinite linear;
        }
        
        /* Lightbox Modal */
        .lightbox {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            z-index: 10000;
            display: none;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .lightbox.active {
            display: flex;
            opacity: 1;
        }

        /* Make cursor visible above lightbox */
        .lightbox.active ~ .cursor,
        body .cursor {
            z-index: 10001;
        }
        
        .lightbox-content {
            position: relative;
            max-width: 90%;
            max-height: 90%;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .lightbox-image {
            max-width: 100%;
            max-height: 80vh;
            object-fit: contain;
            border-radius: 10px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }
        
        .lightbox-caption {
            margin-top: 2rem;
            max-width: 800px;
            text-align: center;
            color: #fff;
            font-size: 1.1rem;
            line-height: 1.6;
            opacity: 0.9;
            padding: 0 2rem;
        }
        
        .lightbox-close {
            position: absolute;
            top: 2rem;
            right: 2rem;
            width: 50px;
            height: 50px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            color: #fff;
            cursor: none;
            pointer-events: auto;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            transition: all 0.3s ease;
        }
        
        .lightbox-close:hover {
            background: rgba(255, 147, 152, 0.3);
            border-color: #FF9398;
            transform: rotate(90deg);
        }
        
        .lightbox-nav {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            width: 60px;
            height: 60px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            color: #fff;
            cursor: none;
            pointer-events: auto;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            transition: all 0.3s ease;
        }
        
        .lightbox-nav:hover {
            background: rgba(73, 197, 182, 0.3);
            border-color: #49c5b6;
        }
        
        .lightbox-nav.prev {
            left: 2rem;
        }
        
        .lightbox-nav.next {
            right: 2rem;
        }
        
        /* Counter */
        .lightbox-counter {
            position: absolute;
            top: 2rem;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 25px;
            padding: 0.8rem 1.5rem;
            color: #fff;
            font-size: 0.9rem;
            letter-spacing: 0.1em;
        }
        
        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 6rem 2rem;
            opacity: 0.6;
        }
        
        .empty-state i {
            font-size: 4rem;
            color: rgba(73, 197, 182, 0.5);
            margin-bottom: 1rem;
        }
        
        .empty-state p {
            font-size: 1.2rem;
        }
        
        /* Mobile Responsive */
        @media (max-width: 1024px) {
            .gallery-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        @media (max-width: 768px) {
            .gallery-container {
                padding: 1rem;
                padding-top: 100px;
            }
            
            .gallery-title {
                font-size: 2rem;
            }
            
            .gallery-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 1rem;
            }
            
            .filter-container {
                padding: 1rem;
            }
            
            .filter-btn {
                padding: 0.6rem 1.2rem;
                font-size: 0.8rem;
            }
            
            .lightbox-nav {
                width: 50px;
                height: 50px;
                font-size: 1.2rem;
            }
            
            .lightbox-nav.prev {
                left: 1rem;
            }
            
            .lightbox-nav.next {
                right: 1rem;
            }
            
            .lightbox-close {
                top: 1rem;
                right: 1rem;
                width: 45px;
                height: 45px;
            }
            
            .lightbox-caption {
                font-size: 0.95rem;
                padding: 0 1rem;
            }
        }
        
        @media (max-width: 480px) {
            .gallery-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Custom Cursor -->
    <div class="cursor"></div>

    <!-- Navigation -->
    <nav class="nav-bar">
        <a href="../index.html" class="nav-logo">KF</a>
        
        <!-- Mobile Menu Toggle -->
        <button class="mobile-menu-toggle" id="mobile-toggle">
            <i class="fas fa-bars"></i>
        </button>
        
        <ul class="nav-links" id="nav-links">
            <li><a href="../index.html">Home</a></li>
            <li><a href="works.html">Works</a></li>
            <li><a href="../index.html#contact">Contact</a></li>
            <li class="dropdown">
                <button class="dropdown-toggle">
                    More <i class="fas fa-chevron-down"></i>
                </button>
                <div class="dropdown-menu">
                    <a href="resume.html">Resume</a>
                    <a href="resources.html">Resources</a>
                    <a href="gallery.html" class="active">Gallery</a>
                    <a href="blog.html">Blog</a>
                </div>
            </li>
        </ul>
    </nav>

    <!-- 3D Canvas Background -->
    <div id="canvas-container"></div>
    
    <!-- Gallery Container -->
    <div class="gallery-container">
        <!-- Header -->
        <div class="gallery-header">
            <h1 class="gallery-title">Gallery</h1>
            <p class="gallery-subtitle">Moments from my research journey</p>
        </div>
        
        <!-- Filter Tabs -->
        <div class="filter-container">
            <button class="filter-btn active" data-filter="all">
                <i class="fas fa-th"></i> All
            </button>
            <button class="filter-btn" data-filter="research">
                <i class="fas fa-flask"></i> Research
            </button>
            <button class="filter-btn" data-filter="conference">
                <i class="fas fa-users"></i> Conferences
            </button>
            <button class="filter-btn" data-filter="teaching">
                <i class="fas fa-chalkboard-teacher"></i> Teaching
            </button>
            <button class="filter-btn" data-filter="travel">
                <i class="fas fa-plane"></i> Travel
            </button>
        </div>
        
        <!-- Gallery Grid -->
        <div class="gallery-grid" id="gallery-grid">
            <!-- Images will be loaded here dynamically -->
        </div>
        
        <!-- Empty State -->
        <div class="empty-state" id="empty-state" style="display: none;">
            <i class="fas fa-images"></i>
            <p>No images found in this category</p>
        </div>
    </div>

    <!-- Lightbox Modal -->
    <div class="lightbox" id="lightbox">
        <button class="lightbox-close" id="lightbox-close">
            <i class="fas fa-times"></i>
        </button>
        
        <div class="lightbox-counter" id="lightbox-counter">
            1 / 1
        </div>
        
        <button class="lightbox-nav prev" id="lightbox-prev">
            <i class="fas fa-chevron-left"></i>
        </button>
        
        <div class="lightbox-content">
            <img src="" alt="" class="lightbox-image" id="lightbox-image">
            <p class="lightbox-caption" id="lightbox-caption"></p>
        </div>
        
        <button class="lightbox-nav next" id="lightbox-next">
            <i class="fas fa-chevron-right"></i>
        </button>
    </div>

    <!-- Three.js Import Map -->
    <script type="importmap">
    {
        "imports": {
            "three": "https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.module.js"
        }
    }
    </script>

    <!-- Three.js Background -->
    <script type="module">
        import { initThreeJS } from '../js/three-background.js';
        initThreeJS();
    </script>

    <!-- Main JavaScript -->
    <script src="../js/main.js"></script>
    
    <!-- Gallery Script -->
    <script>
        // Gallery state
        let galleryData = [];
        let filteredData = [];
        let currentFilter = 'all';
        let currentLightboxIndex = 0;
        let touchStartX = 0;
        let touchEndX = 0;
        
        // Load gallery data
        async function loadGallery() {
            try {
                const response = await fetch('../assets/gallery/gallery.json');
                if (!response.ok) {
                    throw new Error('Failed to load gallery.json');
                }
                galleryData = await response.json();
                galleryData.sort((a, b) => new Date(b.date) - new Date(a.date));
                filteredData = galleryData;
                renderGallery();
            } catch (error) {
                console.error('Error loading gallery:', error);
                document.getElementById('gallery-grid').innerHTML = `
                    <div class="empty-state" style="grid-column: 1 / -1;">
                        <i class="fas fa-exclamation-triangle"></i>
                        <p>Failed to load gallery. Please check that gallery.json exists.</p>
                    </div>
                `;
            }
        }
        
        // Render gallery grid
        function renderGallery() {
            const grid = document.getElementById('gallery-grid');
            const emptyState = document.getElementById('empty-state');
            
            if (filteredData.length === 0) {
                grid.innerHTML = '';
                emptyState.style.display = 'block';
                return;
            }
            
            emptyState.style.display = 'none';
            grid.innerHTML = '';
            
            filteredData.forEach((item, index) => {
                const div = document.createElement('div');
                div.className = 'gallery-item loading';
                div.dataset.index = index;
                div.dataset.category = item.category;
                
                // Create image element
                const img = document.createElement('img');
                img.dataset.src = `../assets/gallery/${item.filename}`; // Use data-src for lazy loading
                img.alt = item.caption || 'Gallery image';
                
                // Lazy load
                const observer = new IntersectionObserver((entries) => {
                    entries.forEach(entry => {
                        if (entry.isIntersecting) {
                            const img = entry.target;
                            img.src = img.dataset.src;
                            img.onload = () => {
                                div.classList.remove('loading');
                            };
                            observer.unobserve(img);
                        }
                    });
                }, {
                    rootMargin: '50px'
                });
                
                observer.observe(img);
                
                // Click to open lightbox
                div.addEventListener('click', () => {
                    openLightbox(index);
                });
                
                div.appendChild(img);
                grid.appendChild(div);
            });
        }
        
        // Filter gallery
        function filterGallery(category) {
            currentFilter = category;
            
            if (category === 'all') {
                filteredData = galleryData;
            } else {
                filteredData = galleryData.filter(item => item.category === category);
            }
            
            renderGallery();
        }
        
        // Open lightbox
        function openLightbox(index) {
            currentLightboxIndex = index;
            const lightbox = document.getElementById('lightbox');
            const img = document.getElementById('lightbox-image');
            const caption = document.getElementById('lightbox-caption');
            const counter = document.getElementById('lightbox-counter');
            
            const item = filteredData[index];
            img.src = `../assets/gallery/${item.filename}`;
            caption.textContent = item.caption || '';
            counter.textContent = `${index + 1} / ${filteredData.length}`;
            
            lightbox.classList.add('active');
            document.body.style.overflow = 'hidden';
        }
        
        // Close lightbox
        function closeLightbox() {
            const lightbox = document.getElementById('lightbox');
            lightbox.classList.remove('active');
            document.body.style.overflow = '';
        }
        
        // Navigate lightbox
        function navigateLightbox(direction) {
            if (direction === 'next') {
                currentLightboxIndex = (currentLightboxIndex + 1) % filteredData.length;
            } else {
                currentLightboxIndex = (currentLightboxIndex - 1 + filteredData.length) % filteredData.length;
            }
            
            const img = document.getElementById('lightbox-image');
            const caption = document.getElementById('lightbox-caption');
            const counter = document.getElementById('lightbox-counter');
            
            const item = filteredData[currentLightboxIndex];
            
            // Fade effect
            img.style.opacity = '0';
            setTimeout(() => {
                img.src = `../assets/gallery/${item.filename}`;
                caption.textContent = item.caption || '';
                counter.textContent = `${currentLightboxIndex + 1} / ${filteredData.length}`;
                img.style.opacity = '1';
            }, 150);
        }
        
        // Event Listeners
        document.addEventListener('DOMContentLoaded', () => {
            loadGallery();
            
            // Filter buttons
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    filterGallery(btn.dataset.filter);
                });
            });
            
            // Lightbox controls
            document.getElementById('lightbox-close').addEventListener('click', closeLightbox);
            document.getElementById('lightbox-prev').addEventListener('click', () => navigateLightbox('prev'));
            document.getElementById('lightbox-next').addEventListener('click', () => navigateLightbox('next'));
            
            // Close on background click
            document.getElementById('lightbox').addEventListener('click', (e) => {
                if (e.target.id === 'lightbox') {
                    closeLightbox();
                }
            });
            
            // Keyboard navigation
            document.addEventListener('keydown', (e) => {
                if (!document.getElementById('lightbox').classList.contains('active')) return;
                
                if (e.key === 'Escape') closeLightbox();
                if (e.key === 'ArrowLeft') navigateLightbox('prev');
                if (e.key === 'ArrowRight') navigateLightbox('next');
            });
            
            // Touch/swipe support
            const lightbox = document.getElementById('lightbox');
            
            lightbox.addEventListener('touchstart', (e) => {
                touchStartX = e.changedTouches[0].screenX;
            }, { passive: true });
            
            lightbox.addEventListener('touchend', (e) => {
                touchEndX = e.changedTouches[0].screenX;
                handleSwipe();
            }, { passive: true });
            
            function handleSwipe() {
                if (touchEndX < touchStartX - 50) {
                    navigateLightbox('next');
                }
                if (touchEndX > touchStartX + 50) {
                    navigateLightbox('prev');
                }
            }
        });
        
        // Smooth image fade transition
        const style = document.createElement('style');
        style.textContent = `
            .lightbox-image {
                transition: opacity 0.15s ease;
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>
